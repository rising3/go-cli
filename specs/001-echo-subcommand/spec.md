# Feature Specification: Echo サブコマンド実装

**Feature Branch**: `001-echo-subcommand`  
**Created**: 2025-11-30  
**Status**: Draft  
**Input**: User description: "cobra-cliを使用してechoサブコマンドを追加実装する。echoサブコマンドは、unixのechoコマンドのクローンとし、同様の仕様とする。"

## Clarifications

### Session 2025-11-30

- Q: エラー時の終了コード → A: エラー時は非ゼロ終了コード（1）を返す
- Q: 無効なオプション処理 → A: エラーメッセージを表示後、自動的にヘルプメッセージを表示
- Q: デバッグログ出力 → A: --verboseフラグでデバッグログを有効化
- Q: ヘルプメッセージの詳細レベル → A: 簡潔な説明 + 主要オプション + 基本的な使用例（2-3個）
- Q: 文字エンコーディング対応 → A: UTF-8のみサポート（Go標準、シンプルな実装）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基本的なテキスト出力 (Priority: P1)

開発者がCLIツールで簡単なテキストメッセージを標準出力に表示したい。引数として渡された文字列をそのまま出力し、デフォルトで改行を末尾に追加する。

**Why this priority**: echoコマンドの最も基本的で頻繁に使用される機能であり、これがなければechoコマンドとして機能しない。単純なメッセージ表示やスクリプトでのログ出力に必須。

**Independent Test**: `mycli echo "Hello, World!"` を実行して `Hello, World!\n` が標準出力に出力されることで完全にテスト可能。他の機能に依存しない独立したMVP。

**Acceptance Scenarios**:

1. **Given** CLIツールがインストールされている、**When** `mycli echo "Hello"` を実行、**Then** 標準出力に `Hello` と改行が出力される
2. **Given** CLIツールがインストールされている、**When** `mycli echo "Line1" "Line2" "Line3"` を実行（複数引数）、**Then** 標準出力に `Line1 Line2 Line3` とスペース区切りで改行付きで出力される
3. **Given** CLIツールがインストールされている、**When** `mycli echo` を引数なしで実行、**Then** 空行（改行のみ）が出力される
4. **Given** CLIツールがインストールされている、**When** `mycli echo "Special chars: !@#$%"` を実行、**Then** 特殊文字がそのまま出力される

---

### User Story 2 - 改行抑制オプション (-n) (Priority: P2)

開発者が改行なしでテキストを出力したい（プロンプト表示やプログレス表示などで）。`-n` オプションを使用して末尾の改行を抑制できる。

**Why this priority**: 改行なし出力は、対話的なプロンプト、同一行での進捗表示、複数の出力を連結する場合に必要。UNIXのechoコマンドで広く使用される標準オプション。

**Independent Test**: `mycli echo -n "Prompt: "` を実行して改行なしで出力されることで独立してテスト可能。基本出力機能（P1）があれば追加実装できる。

**Acceptance Scenarios**:

1. **Given** CLIツールがインストールされている、**When** `mycli echo -n "Hello"` を実行、**Then** 標準出力に `Hello` が改行なしで出力される
2. **Given** CLIツールがインストールされている、**When** `mycli echo -n "A" "B" "C"` を実行、**Then** `A B C` が改行なしで出力される
3. **Given** CLIツールがインストールされている、**When** `mycli echo -n` を引数なしで実行、**Then** 何も出力されない（改行も出力されない）

---

### User Story 3 - エスケープシーケンス解釈 (-e) (Priority: P3)

開発者がバックスラッシュエスケープシーケンス（`\n`, `\t`, `\\` など）を使用して、改行やタブなどの特殊文字を含むテキストを出力したい。`-e` オプションでエスケープシーケンスを解釈する。

**Why this priority**: フォーマット付き出力、複数行メッセージ、タブ区切りデータの生成に便利。ただし、基本的な出力機能がなくても代替手段（複数回のechoコマンド実行）で対応可能なため優先度は低い。

**Independent Test**: `mycli echo -e "Line1\nLine2\tTabbed"` を実行して改行とタブが正しく解釈されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** CLIツールがインストールされている、**When** `mycli echo -e "Hello\nWorld"` を実行、**Then** `Hello` と `World` が2行に分かれて出力される
2. **Given** CLIツールがインストールされている、**When** `mycli echo -e "Col1\tCol2\tCol3"` を実行、**Then** タブ区切りで3つのカラムが出力される
3. **Given** CLIツールがインストールされている、**When** `mycli echo -e "Backslash: \\\\"` を実行、**Then** `Backslash: \` が出力される（バックスラッシュのエスケープ）
4. **Given** CLIツールがインストールされている、**When** `mycli echo -e "Quote: \""` を実行、**Then** `Quote: "` が出力される
5. **Given** `-e` オプションが指定されていない、**When** `mycli echo "Hello\nWorld"` を実行、**Then** `Hello\nWorld` がリテラル文字列として出力される（エスケープ解釈しない）

---

### User Story 4 - オプション組み合わせ (Priority: P4)

開発者が `-n` と `-e` を組み合わせて使用したい（例: エスケープシーケンスを解釈しつつ改行を抑制）。

**Why this priority**: 高度な使用ケースだが、個別オプションが実装されていれば自然に対応可能。使用頻度は低いが、完全なUNIX互換性のために必要。

**Independent Test**: `mycli echo -n -e "Hello\tWorld"` を実行してタブが解釈され改行が抑制されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** CLIツールがインストールされている、**When** `mycli echo -n -e "Tab\there"` を実行、**Then** タブが解釈され、改行なしで出力される
2. **Given** CLIツールがインストールされている、**When** `mycli echo -e -n "Same\nLine"` を実行（オプション順序逆）、**Then** 改行が解釈されて2行出力されるが、最後の改行は抑制される

---

### Edge Cases

- **引数に空文字列が含まれる場合**: `mycli echo "" "test"` → ` test` （空文字列もスペース区切りの一部として扱う）
- **引数が大量の場合**: 1000個以上の引数でもメモリエラーなく処理できる
- **特殊文字が含まれる場合**: シェルの特殊文字（`$`, `*`, `?` など）はシェルによって展開されるが、echoコマンド自体は受け取った引数をそのまま出力する
- **無効なエスケープシーケンス**: `-e` オプション使用時に無効なエスケープ（例: `\z`）がある場合、リテラル文字列として出力（UNIX標準動作）
- **オプションと引数の区別**: `mycli echo -n -e -- -n` のように `--` で区切ることで、その後の `-n` を引数として扱える（標準POSIX動作）
- **無効なオプション指定**: `mycli echo -x "text"` → エラーメッセージ "unknown flag: -x" をstderrに出力し、ヘルプメッセージを表示後、終了コード1で終了
- **非UTF-8バイト列**: UTF-8以外のバイト列が入力された場合の動作は未定義（Go標準の文字列処理に依存）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: `mycli echo` コマンドは、引数として渡されたすべての文字列をスペース区切りで標準出力に出力しなければならない
- **FR-002**: デフォルトでは出力の末尾に改行文字を追加しなければならない
- **FR-003**: `-n` オプションが指定された場合、末尾の改行を出力してはならない
- **FR-004**: `-e` オプションが指定された場合、以下のバックスラッシュエスケープシーケンスを解釈しなければならない:
  - `\n`: 改行
  - `\t`: タブ
  - `\\`: バックスラッシュ
  - `\"`: ダブルクォート
  - `\a`: ベル（alert）
  - `\b`: バックスペース
  - `\c`: これ以降の出力を抑制（改行も含む）
  - `\r`: キャリッジリターン
  - `\v`: 垂直タブ
- **FR-005**: `-e` オプションが指定されていない場合、バックスラッシュエスケープをリテラル文字列として出力しなければならない
- **FR-006**: 複数のオプション（`-n` と `-e`）を同時に指定可能でなければならない
- **FR-007**: 引数がない場合、空行（改行のみ、または `-n` 指定時は何も出力しない）を出力しなければならない
- **FR-008**: コマンドのヘルプメッセージ（`mycli echo --help`）は、簡潔な説明、主要オプション、2-3個の基本的な使用例を明確に示さなければならない
- **FR-009**: エラーは標準エラー出力（stderr）に出力し、標準出力（stdout）は正常な出力のみに使用しなければならない
- **FR-010**: Cobraフレームワークを使用してサブコマンドとして実装しなければならない
- **FR-011**: エラー発生時（無効なオプションなど）は、終了コード1で終了しなければならない。正常終了時は終了コード0を返す
- **FR-012**: 無効なオプションが指定された場合、エラーメッセージをstderrに出力し、その後自動的にヘルプメッセージを表示しなければならない
- **FR-013**: `--verbose` フラグが指定された場合、詳細なデバッグ情報（処理されたオプション、エスケープシーケンス変換の詳細など）をstderrに出力しなければならない
- **FR-014**: 入力文字列はUTF-8エンコーディングとして処理しなければならない（他のエンコーディングはサポート対象外）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーが `mycli echo "test"` を実行すると、100ms以内に標準出力に結果が表示される
- **SC-002**: UNIX標準の `echo` コマンドと同じ引数を渡したとき、同じ出力結果が得られる（互換性）
- **SC-003**: `mycli echo --help` を実行すると、50ms以内に簡潔で明確なヘルプメッセージ（説明、オプション、2-3個の使用例を含む）が表示される
- **SC-004**: 10,000個の引数を渡しても、メモリ使用量が100MB以下でクラッシュせずに処理が完了する
- **SC-005**: すべてのエスケープシーケンス（`\n`, `\t`, `\\`, `\"`, `\a`, `\b`, `\c`, `\r`, `\v`）が正しく解釈される
- **SC-006**: TDDアプローチにより、すべての機能要件に対応する単体テストが実装され、`make test` でパスする
- **SC-007**: 無効なオプション指定時、適切なエラーメッセージとヘルプが表示され、終了コード1で終了する
- **SC-008**: `--verbose` フラグ使用時、デバッグ情報がstderrに出力され、トラブルシューティングが可能である
